<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unimates - Search</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Poppins',sans-serif; background:#f5f7fa; color:#333; padding:2rem; }
    header { background:linear-gradient(135deg,#2980b9,#6dd5fa); color:#fff; padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; }
    nav ul { list-style:none; display:flex; gap:1.5rem; }
    nav a { color:#fff; text-decoration:none; }
    .greeting { margin-right:2rem; font-weight:300; }
    h2 { margin-top:1rem; }
    .message { position:fixed; top:1rem; right:1rem; background:#e74c3c; color:#fff; padding:0.7rem 1rem; border-radius:4px; display:none; }
    .filter {
      background:#fff; padding:1.5rem; border-radius:8px;
      display:flex; flex-wrap:wrap; gap:1rem;
      box-shadow:0 4px 8px rgba(0,0,0,0.1);
      margin-bottom:1rem;
    }
    .filter label { display:flex; flex-direction:column; font-size:0.9rem; flex:1 1 150px; }
    .filter select, .filter input[type="range"] { padding:0.5rem; border:1px solid #ccc; border-radius:4px; }
    .filter button {
      background:#2980b9; color:#fff; border:none;
      padding:0.7rem 1.2rem; border-radius:4px;
      cursor:pointer; font-weight:600;
      transition:background 0.3s;
      flex:1 1 auto;
    }
    .filter button:hover { background:#1f5a88; }
    .advanced { margin-top:1rem; padding:1rem; background:#fafafa; border-radius:6px; }
    .advanced h3 { margin-bottom:0.5rem; font-size:1rem; }
    .advanced .options { display:flex; gap:1rem; flex-wrap:wrap; }
    .advanced label { display:flex; align-items:center; gap:0.5rem; font-size:0.9rem; }
    .property-list { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:2rem; }
    .best-match { font-weight:600; margin-bottom:1rem; }
    .card { background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition:transform 0.2s; }
    .card:hover { transform:translateY(-5px); }
    .card img { width:100%; height:150px; object-fit:cover; }
    .card-content { padding:1rem; }
    .card-content p { margin:0.3rem 0; }
    .card button { margin-top:0.5rem; padding:0.5rem 1rem; background:#2980b9; color:#fff; border:none; border-radius:4px; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <div class="greeting">Welcome, User</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="search.html">Search</a></li>
        <li><a href="list-property.html">List Property</a></li>
        <li><a href="messages.html">Messages</a></li>
      </ul>
    </nav>
  </header>
  <div class="message" id="message"></div>
  <main>
    <h2>Search Properties</h2>
    <div class="filter">
      <label>Budget Range:
        <input type="range" id="budget" min="100" max="2000" value="1000">
        <span>$<span id="budgetValue">1000</span></span>
      </label>
      <label>University:
        <select id="university">
          <option value="">Any</option>
          <option>University of Sydney</option>
          <option>UNSW</option>
          <option>UTS</option>
          <option>Macquarie University</option>
        </select>
      </label>
      <label>Distance (km):
        <select id="distance">
          <option value="">Any</option>
          <option value="1">1 km</option>
          <option value="5">5 km</option>
          <option value="10">10 km</option>
        </select>
      </label>
      <label>Rating:
        <select id="rating">
          <option value="">Any</option>
          <option value="5">5 ★</option>
          <option value="4">4+ ★</option>
          <option value="3">3+ ★</option>
          <option value="2">2+ ★</option>
          <option value="1">1+ ★</option>
        </select>
      </label>
      <button id="searchBtn">Search</button>
    </div>
    <div class="advanced">
      <h3>Advanced Filters</h3>
      <div class="options">
        <div>
          <strong>Indoor Features:</strong><br>
          <label><input type="checkbox" id="featureA" /> Air Conditioning</label><br>
          <label><input type="checkbox" id="featureB" /> Furnished</label><br>
          <label><input type="checkbox" id="featureC" /> Wifi</label>
        </div>
        <div>
          <label>Roommates:
            <select id="roommates">
              <option value="">Any</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </label>
        </div>
        <div>
          <label>House Type:
            <select id="houseType">
              <option value="">Any</option>
              <option>Apartment</option>
              <option>Studio</option>
              <option>Sharehouse</option>
            </select>
          </label>
        </div>
      </div>
    </div>
    <div class="best-match" id="bestMatchLabel" style="display:none;">Best Match</div>
    <div class="property-list" id="propertyList"></div>
  </main>

  <script>
    const properties = [
      { title:'Cozy Sydney Room', owner:'Alice', convId:'1', price:700, university:'University of Sydney', distance:2, rating:4, features:['Air Conditioning','Wifi'], roommates:true, houseType:'Sharehouse', img:'usyd.avif' },
      { title:'Modern UNSW Apt', owner:'Bob', convId:'2', price:1200, university:'UNSW', distance:3, rating:5, features:['Air Conditioning','Furnished'], roommates:false, houseType:'Apartment', img:'unsw.jpg' },
      { title:'UTS Shared House', owner:'Charlie', convId:'3', price:800, university:'UTS', distance:1, rating:3, features:['Wifi'], roommates:true, houseType:'Sharehouse', img:'uts.jpg' },
      { title:'Macquarie Studio', owner:'Dana', convId:'4', price:900, university:'Macquarie University', distance:5, rating:4, features:['Furnished'], roommates:false, houseType:'Studio', img:'macq.jpg' }
    ];
    function showMessage(text) {
      const msg = document.getElementById('message'); msg.textContent = text; msg.style.display = 'block'; setTimeout(() => { msg.style.display = 'none'; }, 3000);
    }
    function render(list) {
      const container = document.getElementById('propertyList'); container.innerHTML = '';
      if (!list.length) { container.innerHTML = '<p>No properties found.</p>'; return; }
      document.getElementById('bestMatchLabel').style.display = 'block';
      list.forEach(p => {
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `
          <img src="${p.img}" alt="${p.title}">
          <div class="card-content">
            <h3>${p.title}</h3>
            <p><strong>Owner:</strong> ${p.owner}</p>
            <p>Price: $${p.price}</p>
            <p>University: ${p.university}</p>
            <p>Distance: ${p.distance} km</p>
            <p>Rating: ${p.rating} ★</p>
            <p>Type: ${p.houseType}</p>
          </div>
          <button onclick="location.href='messages.html?convId=${p.convId}'">Message ${p.owner}</button>
        `;
        container.appendChild(card);
      });
    }
    document.getElementById('budget').addEventListener('input', e => { document.getElementById('budgetValue').textContent = e.target.value; });
    document.getElementById('searchBtn').addEventListener('click', () => {
      try {
        const b = +document.getElementById('budget').value;
        const uni = document.getElementById('university').value;
        const dVal = document.getElementById('distance').value;
        const maxDist = dVal ? +dVal : null;
        const rVal = document.getElementById('rating').value;
        const minRating = rVal ? +rVal : null;
        const features = [];
        if(document.getElementById('featureA').checked) features.push('Air Conditioning');
        if(document.getElementById('featureB').checked) features.push('Furnished');
        if(document.getElementById('featureC').checked) features.push('Wifi');
        const roommatesSel = document.getElementById('roommates').value;
        const houseTypeSel = document.getElementById('houseType').value;
        let results = properties.filter(p => p.price <= b);
        if (uni) results = results.filter(p => p.university === uni);
        if (maxDist !== null) results = results.filter(p => p.distance <= maxDist);
        if (minRating !== null) results = results.filter(p => p.rating >= minRating);
        if (features.length) results = results.filter(p => features.every(f => p.features.includes(f)));
        if (roommatesSel) results = results.filter(p => (roommatesSel==='Yes') === p.roommates);
        if (houseTypeSel) results = results.filter(p => p.houseType === houseTypeSel);
        render(results);
      } catch (err) {
        showMessage('Connection error. Please try again.');
      }
    });
    window.onload = () => render(properties);
  </script>