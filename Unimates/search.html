<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unimates - Search</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Poppins',sans-serif; background:#f5f7fa; color:#333; padding:2rem; }
    header { background:linear-gradient(135deg,#2980b9,#6dd5fa); color:#fff; padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; }
    nav ul { list-style:none; display:flex; gap:1.5rem; }
    nav a { color:#fff; text-decoration:none; }
    .greeting { margin-right:2rem; font-weight:300; }
    h2 { margin-top:1rem; }
    .message { position:fixed; top:1rem; right:1rem; background:#e74c3c; color:#fff; padding:0.7rem 1rem; border-radius:4px; display:none; }
    .filter { background:#fff; padding:1.5rem; border-radius:8px; display:flex; flex-wrap:wrap; gap:1rem; box-shadow:0 4px 8px rgba(0,0,0,0.1); margin-bottom:1rem; }
    .filter label { display:flex; flex-direction:column; font-size:0.9rem; flex:1 1 150px; }
    .filter select, .filter input[type="range"] { padding:0.5rem; border:1px solid #ccc; border-radius:4px; }
    .filter button { background:linear-gradient(135deg,#2980b9,#6dd5fa); color:#fff; border:none; padding:0.8rem 1.5rem; border-radius:8px; cursor:pointer; font-weight:600; font-size:1rem; display:flex; align-items:center; justify-content:center; gap:0.5rem; }
    .filter button:hover { background:linear-gradient(135deg,#1f5a88,#4aaeda); }
    .advanced { margin-top:1rem; padding:1rem; background:#fafafa; border-radius:6px; }
    .advanced h3 { margin-bottom:0.5rem; font-size:1rem; }
    .advanced .options { display:flex; gap:2rem; flex-wrap:wrap; }
    .advanced .features, .advanced .dropdowns { display:flex; flex-direction:column; gap:0.5rem; }
    .advanced label { display:flex; align-items:center; gap:0.5rem; font-size:0.9rem; }
    .property-list { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:2rem; }
    .best-match { font-weight:600; margin-bottom:1rem; }
    .card { background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition:transform 0.2s; }
    .card:hover { transform:translateY(-5px); }
    .card img { width:100%; height:150px; object-fit:cover; }
    .card-content { padding:1rem; }
    .card-content p { margin:0.3rem 0; }
    .card button { margin-top:0.5rem; padding:0.5rem 1rem; background:#2980b9; color:#fff; border:none; border-radius:4px; cursor:pointer; }
    /* Detail modal */
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; }
    .modal-content { background:#fff; padding:1.5rem; border-radius:8px; max-width:400px; width:90%; }
    .modal-content h4 { margin-bottom:0.5rem; }
    .modal-content p { margin:0.3rem 0; }
    .modal-content ul { list-style:disc; margin-left:1.2rem; }
  </style>
</head>
<body>
  <header>
    <div class="greeting">Welcome, User</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="search.html">Search</a></li>
        <li><a href="list-property.html">List Property</a></li>
        <li><a href="messages.html">Messages</a></li>
      </ul>
    </nav>
  </header>
  <div class="message" id="message"></div>
  <main>
    <h2>Search Properties</h2>
    <div class="filter">
      <label>Budget Range:
        <input type="range" id="budget" min="100" max="2000" value="1000">
        <span>$<span id="budgetValue">1000</span></span>
      </label>
      <label>University:
        <select id="university">
          <option value="">Any</option>
          <option>University of Sydney</option>
          <option>UNSW</option>
          <option>UTS</option>
          <option>Macquarie University</option>
        </select>
      </label>
      <label>Distance (km):
        <select id="distance">
          <option value="">Any</option>
          <option value="1">1 km</option>
          <option value="5">5 km</option>
          <option value="10">10 km</option>
        </select>
      </label>
      <label>Rating:
        <select id="rating">
          <option value="">Any</option>
          <option value="5">5 ‚òÖ</option>
          <option value="4">4+ ‚òÖ</option>
          <option value="3">3+ ‚òÖ</option>
          <option value="2">2+ ‚òÖ</option>
          <option value="1">1+ ‚òÖ</option>
        </select>
      </label>
      <label>Roommates:
        <select id="roommates">
          <option value="">Any</option>
          <option>Yes</option>
          <option>No</option>
        </select>
      </label>      
      <button id="searchBtn">üîç Search</button>
    </div>
    <!-- Advanced Filters -->
    <div class="advanced">
      <h3>Advanced Filters</h3>
      <!-- Collapsible Other Features -->
      <details style="margin-bottom:1rem;">
        <summary style="cursor:pointer; font-weight:500;">Other Features</summary>
        <div class="features" style="margin-top:0.5rem; display:flex; flex-direction:column; gap:0.5rem;">
          <label><input type="checkbox" id="feat-wifi"/> Wifi</label>
          <label><input type="checkbox" id="feat-laundry"/> Laundry</label>
          <label><input type="checkbox" id="feat-parking"/> Parking</label>
          <label><input type="checkbox" id="feat-ac"/> Air Conditioning</label>
          <label><input type="checkbox" id="feat-furnished"/> Furnished</label>
          <label><input type="checkbox" id="feat-heating"/> Heating</label>
          <label><input type="checkbox" id="feat-desk"/> Study Desk</label>
        </div>
      </details>
      <div class="dropdowns">
        <label>House Type:
          <select id="houseType">
            <option value="">Any</option>
            <option>Apartment</option>
            <option>Studio</option>
            <option>Sharehouse</option>
          </select>
        </label>
      </div>
    </div>
    <div class="best-match" id="bestMatchLabel" style="display:none;">Best Match</div>
    <div class="property-list" id="propertyList"></div>
  </main>

  <!-- Detail Modal -->
  <div class="modal" id="detailModal">
    <div class="modal-content">
      <h4 id="detailTitle"></h4>
      <p><strong>Price:</strong> <span id="detailPrice"></span></p>
      <p><strong>University:</strong> <span id="detailUni"></span></p>
      <p><strong>Distance:</strong> <span id="detailDist"></span> km</p>
      <p><strong>Rating:</strong> <span id="detailRating"></span> ‚òÖ</p>
      <p><strong>Type:</strong> <span id="detailType"></span></p>
      <p><strong>Features:</strong></p>
      <ul id="detailFeatures"></ul>
      <button onclick="document.getElementById('detailModal').style.display='none'">Close</button>
    </div>
  </div>

  <script>
    let lastResults = [];
    const properties = [
      { title:'Cozy Sydney Room', owner:'Alice', convId:'1', price:700, university:'University of Sydney', distance:2, rating:4, features:['Air Conditioning','Wifi'], roommates:true, houseType:'Sharehouse', img:'usyd.avif' },
      { title:'Modern UNSW Apt', owner:'Bob', convId:'2', price:1200, university:'UNSW', distance:3, rating:5, features:['Air Conditioning','Furnished'], roommates:false, houseType:'Apartment', img:'unsw.jpg' },
      { title:'UTS Shared House', owner:'Charlie', convId:'3', price:800, university:'UTS', distance:1, rating:3, features:['Wifi'], roommates:true, houseType:'Sharehouse', img:'uts.jpg' },
      { title:'Macquarie Studio', owner:'Dana', convId:'4', price:900, university:'Macquarie University', distance:5, rating:4, features:['Furnished'], roommates:false, houseType:'Studio', img:'macq.jpg' }
    ];
    function showMessage(text) {
      const msg = document.getElementById('message'); msg.textContent = text; msg.style.display = 'block'; setTimeout(() => { msg.style.display = 'none'; }, 3000);
    }
    function render(list) {
      lastResults = list;
      const container = document.getElementById('propertyList'); container.innerHTML = '';
      if (!list.length) { container.innerHTML = '<p>No properties found.</p>'; return; }
      document.getElementById('bestMatchLabel').style.display = 'block';
      list.forEach((p,i) => {
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `
          <img src="${p.img}" alt="${p.title}">
          <div class="card-content">
            <h3>${p.title}</h3>
            <p><strong>Owner:</strong> ${p.owner}</p>
            <p>Price: $${p.price}</p>
            <p>University: ${p.university}</p>
            <p>Distance: ${p.distance} km</p>
            <p>Rating: ${p.rating} ‚òÖ</p>
            <p>Type: ${p.houseType}</p>
          </div>
          <button onclick="showDetails(${i})">View Details</button>
          <button onclick="location.href='messages.html?convId=${p.convId}'">Message ${p.owner}</button>
        `;
        container.appendChild(card);
      });
    }
    function showDetails(index) {
      const p = lastResults[index];
      document.getElementById('detailTitle').textContent = p.title;
      document.getElementById('detailPrice').textContent = '$'+p.price+'/wk';
      document.getElementById('detailUni').textContent = p.university;
      document.getElementById('detailDist').textContent = p.distance;
      document.getElementById('detailRating').textContent = p.rating;
      document.getElementById('detailType').textContent = p.houseType;
      const ul = document.getElementById('detailFeatures'); ul.innerHTML = '';
      p.features.forEach(f => { const li=document.createElement('li'); li.textContent = f; ul.appendChild(li); });
      document.getElementById('detailModal').style.display='flex';
    }
    document.getElementById('budget').addEventListener('input', e => { document.getElementById('budgetValue').textContent = e.target.value; });
    document.getElementById('searchBtn').addEventListener('click', () => {
      try {
        const b = +document.getElementById('budget').value;
        const uni = document.getElementById('university').value;
        const dVal = document.getElementById('distance').value;
        const maxDist = dVal ? +dVal : null;
        const rVal = document.getElementById('rating').value;
        const minRating = rVal ? +rVal : null;
        // advanced selections
        const otherSel = [];
        ['wifi','laundry','parking','ac','furnished','heating','desk'].forEach(key => {
          if (document.getElementById('feat-'+key).checked) otherSel.push(
            key==='ac'?'Air Conditioning': key==='desk'?'Study Desk': key.charAt(0).toUpperCase()+key.slice(1)
          );
        });
        const roommatesSel = document.getElementById('roommates').value;
        const houseTypeSel = document.getElementById('houseType').value;
        let results = properties.filter(p => p.price <= b);
        if (uni) results = results.filter(p => p.university === uni);
        if (maxDist !== null) results = results.filter(p => p.distance <= maxDist);
        if (minRating !== null) results = results.filter(p => p.rating >= minRating);
        if (otherSel.length) results = results.filter(p => otherSel.every(f => p.features.includes(f)));
        if (roommatesSel) results = results.filter(p => (roommatesSel==='Yes') === p.roommates);
        if (houseTypeSel) results = results.filter(p => p.houseType === houseTypeSel);
        render(results);
      } catch (err) { showMessage('Connection error. Please try again.'); }
    });
    window.onload = () => render(properties);
  </script>
